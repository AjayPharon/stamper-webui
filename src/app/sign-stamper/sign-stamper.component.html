<body>
<div class="d-flex">
    <div class="col-8">
        <div class="d-flex justify-content-center">
            <div class="d-flex flex-column">
                <div class="card">
                    <p-galleria
                            [value]="documentImageList"
                            [showItemNavigators]="true"
                            [thumbnailsPosition]="position"
                            [showThumbnails]="false"
                            [(activeIndex)]="activeIndex"
                            [responsiveOptions]="responsiveOptions"
                            [containerStyle]="{ 'max-width': '612px' }"
                            [numVisible]="5"
                            #myGalleria
                    >
                        <ng-template pTemplate="item" let-item>
                            <div class="bg-img" #mybounds>
                                <div>
                                    <img
                                            class="img-single"
                                            [src]="item"
                                            alt="รูปภาพ"
                                            (click)="showTextFrame($event)"
                                    />
                                </div>
                                <ng-container *ngFor="let list of this.textList">
                                    <p
                                            *ngIf="list.isVisible"
                                            class="text-stamp"
                                            ngDraggable
                                            [position]="{ x: list.x, y: list.y }"
                                            [bounds]="mybounds"
                                            [inBounds]="true"
                                            (endOffset)="onMoveEnd($event, list)"
                                    >
                                        {{ list.message }}
                                    </p>
                                </ng-container>
                                <ng-container *ngFor="let list of this.imageList">
                                    <div
                                            *ngIf="list.isVisible"
                                            ngDraggable
                                            ngResizable
                                            [rzAspectRatio]="true"
                                            rzHandles="n,s,e,w,se,sw"
                                            class="sign-img"
                                            [position]="{ x: list.x, y: list.y }"
                                            [bounds]="mybounds"
                                            [inBounds]="true"
                                            (endOffset)="onMoveEnd($event, list)"
                                            (rzResizing)="onResizing($event, list)"
                                            [style.width.px]="400"
                                            [style.height.px]="150"
                                            [rzMinWidth]="100"
                                            [rzMaxWidth]="612"
                                            [rzMinHeight]="100"
                                            [rzMaxHeight]="792"
                                    >
                                        <img
                                                style="width: 100%; height: 100%"
                                                [src]="list.signContent"
                                                #targetRef
                                                #imgstamp
                                        />
                                    </div>
                                </ng-container>
                            </div>

                        </ng-template>
                    </p-galleria>

                    <!-- <cdk-virtual-scroll-viewport
                      itemSize="800"
                      minBufferPx="200"
                      maxBufferPx="400"
                      class="example-viewport"
                    >
                      <span #mybounds>
                        <div
                          class="bg-img"
                          *cdkVirtualFor="let item of documentImageList"
                        >
                          <img

                            class="img-single"
                            [src]="item"
                            alt="รูปภาพ"
                            (click)="showTextFrame($event)"
                          />
                        </div>
                        <ng-container *ngIf="showText">
                          <p
                            *ngFor="let list of this.textStampList"
                            class="text-stamp"
                            ngDraggable
                            [bounds]="mybounds"
                            [inBounds]="true"
                            (endOffset)="onMoveEnd($event, list)"
                          >
                            {{ list.message }}
                          </p>
                        </ng-container>

                        <ng-container *ngIf="this.signVisible">
                          <div
                            *ngFor="let list of this.imageStampList"
                            ngDraggable
                            ngResizable
                            [rzAspectRatio]="true"
                            rzHandles="n,s,e,w,se,sw"
                            class="sign-img"
                            [bounds]="mybounds"
                            [inBounds]="true"
                            (endOffset)="onMoveEnd($event, list)"
                            (rzResizing)="onResizing($event, list)"
                            [rzMinWidth]="100"
                            [rzMaxWidth]="612"
                            [rzMinHeight]="100"
                            [rzMaxHeight]="792"
                          >
                            <img
                              [width]="list.signWidth"
                              [height]="list.signHeight"
                              [src]="list.signContent"
                              (click)="getInfo(list)"
                              #targetRef
                            />
                          </div>
                        </ng-container>
                      </span>
                    </cdk-virtual-scroll-viewport> -->
                    <!-- <div  > -->
                </div>
                <div class="d-flex justify-content-between">
                    <p-button
                            icon="pi pi-chevron-left"
                            (click)="showPreviousImage()"
                    ></p-button>
                    <p> {{ activeIndex }}  of {{ this.documentImageList.length }}</p>
                    <p-button
                            icon="pi pi-chevron-right"
                            (click)="showNextImage()"
                    ></p-button>
                </div>
            </div>
        </div>
    </div>
    <div class="col-3">
        <div class="col mt-5">
            <p-fileUpload
                    name="file[]"
                    [multiple]="false"
                    [showUploadButton]="false"
                    [showCancelButton]="false"
                    accept=".pdf"
                    chooseLabel="เพิ่มเอกสาร"
                    [fileLimit]="1"
                    (onSelect)="documentUpload($event)"
                    (onRemove)="onFileRemove($event)"
            ></p-fileUpload>
        </div>
        <div class="col mt-5">
            <p-fileUpload
                    name="file[]"
                    [multiple]="false"
                    [showUploadButton]="false"
                    [showCancelButton]="false"
                    accept="image/*"
                    chooseLabel="เพิ่มลายเซ็น"
                    (onSelect)="onFileSelect($event)"
                    (onRemove)="onFileRemove($event)"
            ></p-fileUpload>
        </div>
        <div class="row mt-5">
            <div class="col m-2">
                <p-button label="เพิ่มข้อความ" (click)="openDialog()"></p-button>

            </div>
            <div class="col m-2">
                <p-button label="เพิ่ม Stamp" (click)="chooseTemplate()"></p-button>
            </div>
        </div>
        <div class="col mt-5">
            <p-button label="Stamp" (click)="stamp()"></p-button>
        </div>
    </div>
</div>
</body>
<p-dialog
        class="pnDialog"
        header="เพิ่มข้อความ"
        [(visible)]="DisplayDialogAddTopic"
        [modal]="true"
        [dismissableMask]="true"
        [draggable]="false"
        [resizable]="false"
        [breakpoints]="{ '1200px': '60vw', '800px': '90vw' }"
        [style]="{ width: '40vw' }"
>
    <input id="stamp" type="text" pInputText [(ngModel)]="this.textStamp"/>
    <p-button label="เพิ่มข้อความ" (click)="submitDialog()"></p-button>
</p-dialog>

<p-dialog
        class="pnDialog"
        header="Stamp"
        [(visible)]="displayDialog"
        [modal]="true"
        [dismissableMask]="true"
        [draggable]="false"
        [resizable]="false"
        [breakpoints]="{ '1440px': '60vw', '1000px': '85vw' }"
        [style]="{ width: '50vw', height: '90vh' }"
        (onShow)="onShowDialog()"
>
    <p-button label="สร้าง Stamp ของคุณ" (click)="openConfigDialog()"></p-button>
    <div class="d-flex flex-column align-items-center justify-content-center" *ngIf="displayStampDialog">
        <div>
            ยังไม่มี Template ที่สร้างไว้
        </div>
        <p-button label="สร้าง Stamp" (click)="openConfigDialog()"></p-button>
    </div>
    <div *ngIf="displayChooseDialog">
        <div class="d-flex flex-column justify-content-center h-100">
            <div class="d-flex flex-row align-items-center">
                <label for="stampName">ชื่อStamp</label>
                <input id="stampName" type="text" pInputText [(ngModel)]="templateName"/>
            </div>

            <!-- region for component-button -->
            <div class="d-flex flex-row mb-2">
                <div class="m-2">
                    <button id="borderBtn" class="border-btn" (click)="toggleBorder()">
                        Border
                    </button>
                </div>
                <div class="m-2">
                    <button class="text-btn" (click)="addText()">Text</button>
                </div>
                <div class="m-2">
                    <button class="image-btn" (click)="fileInput.click()">Image</button>
                    <input
                        #fileInput
                        type="file"
                        (change)="addImage($event)"
                        style="display: none"
                        accept="image/*"
                    />
                </div>
                <div class="m-2">
                    <button class="label-btn" (click)="addLabel()">Label</button>
                </div>
                <!-- <p-checkbox
                    [(ngModel)]="gridOption"
                    [binary]="true"
                    inputId="gridOption"
                    (onChange)="drawBorder()"
                  ></p-checkbox>
                  <label for="gridOption">กรอบข้อความ</label> -->
            </div>
            <!-- endregion component-button -->

            <!-- region canvas-area -->
            <div class="bgCanvas mb-2">
                <canvas
                    #bgCanvas
                    id="bgCanvas"
                    width="800"
                    height="300"
                    style="border: 1px solid #282020"
                ></canvas>
                <canvas id="fgCanvas" width="800" height="300" hidden></canvas>

                <!-- region text-stamp -->
                <div
                        class="componentCanvas"
                        *ngFor="let list of textStampList; let i = index"
                        [ngDraggable]="list.showTools ? false : true"
                        [position]="{ x: list.x, y: list.y }"
                        [bounds]="bgCanvas"
                        [inBounds]="true"
                        (endOffset)="onMoveEnd($event, list)"
                >
                    <div
                            class="d-flex align-items-center"
                            (mouseover)="showEdit(list)"
                            (mouseleave)="hideEdit(list)"
                    >
                        <p
                                id="textStamp"
                                class="textStamp"
                                [attr.contenteditable]="list.showTools ? 'true' : 'false'"
                                (input)="onContentChange($event, list)"
                                [style.width.px]="getMaxLineWidth(list.content, '16px Arial')"
                                [style.fontWeight]="list.isBold ? 'bold' : 'normal'"
                                [style.fontStyle]="list.isItalic ? 'italic' : 'normal'"
                                [style.color]="list.color"
                                [style.border]="list.showTools ? '1px solid #000055' : 'none'"
                                [style.fontSize.px]="list.fontSize"
                        >
                            เพิ่มข้อความ
                        </p>
                        <i
                                *ngIf="list.showEdit"
                                class="pi"
                                [ngClass]="{
              'pi-pencil': !list.showTools,
              'pi-check': list.showTools
            }"
                                style="color: rgb(81, 81, 81); font-size: 1rem; margin: 3px"
                                (click)="editMode(list)"
                        ></i>
                    </div>

                    <div
                            class="d-flex justify-content-end textEditor"
                            *ngIf="list.showTools"
                    >
                        <p-colorPicker [(ngModel)]="list.color"></p-colorPicker>
                        <div class="card flex justify-content-center">
                            <p-dropdown
                                    [options]="fontSizes"
                                    [(ngModel)]="list.fontSize"
                                    [showClear]="false"
                                    placeholder="Font Sizes"
                            ></p-dropdown>
                        </div>
                        <button style="font-size: 1rem" (click)="boldText(list)">B</button>
                        <button style="font-size: 1rem" (click)="italicText(list)">I</button>
                        <i
                                class="pi pi-trash"
                                style="
              color: red;
              font-size: 1.7rem;
              margin-left: 85px;
              margin-top: 5px;
            "
                                (click)="delete(i)"
                        ></i>
                    </div>
                </div>
                <!-- endregion text-stamp -->

                <!-- region image-stamp -->
                <div
                        *ngFor="let list of imageStampList; let i = index"
                        ngDraggable
                        ngResizable
                        [rzAspectRatio]="true"
                        rzHandles="n,s,e,w,se,sw"
                        class="componentCanvas"
                        [position]="{ x: list.x, y: list.y }"
                        [bounds]="bgCanvas"
                        [inBounds]="true"
                        (endOffset)="onMoveEnd($event, list)"
                        (rzResizing)="onResizingTemplate($event, list)"
                        [style.width.px]="list.signWidth"
                        [style.height.px]="list.signHeight"
                        [rzMinWidth]="100"
                        [rzMaxWidth]="800"
                        [rzMinHeight]="100"
                        [rzMaxHeight]="300"
                        (mouseover)="showEdit(list)"
                        (mouseleave)="hideEdit(list)"
                >
                    <img
                            [width]="list.signWidth"
                            [height]="list.signHeight"
                            [src]="list.signContent"
                            #targetRef
                            #imgstamp
                    />
                    <i
                            *ngIf="list.showEdit"
                            class="pi pi-trash"
                            style="color: rgb(255, 0, 0); font-size: 1.5rem; margin: 3px"
                            (click)="deleteImage(i)"
                    ></i>
                </div>
                <!-- endregion image-stamp -->

                <!-- region label-stamp -->
                <div
                        class="componentCanvas"
                        *ngFor="let list of labelStampList; let i = index"
                        [ngDraggable]="list.showTools ? false : true"
                        [position]="{ x: list.x, y: list.y }"
                        [bounds]="bgCanvas"
                        [inBounds]="true"
                        (endOffset)="onMoveEnd($event, list)"
                >
                    <div
                            class="d-flex align-items-center"
                            (mouseover)="showEdit(list)"
                            (mouseleave)="hideEdit(list)"
                    >
                        <p
                                id="labelStamp"
                                class="label"
                                [attr.contenteditable]="list.showTools ? 'true' : 'false'"
                                (input)="onLabelChange($event, list)"
                                [style.fontWeight]="list.isBold ? 'bold' : 'normal'"
                                [style.fontStyle]="list.isItalic ? 'italic' : 'normal'"
                                [style.color]="list.color"
                                [style.border]="list.showTools ? '1px solid #000055' : 'none'"
                                [style.fontSize.px]="list.fontSize"
                        >
                            เพิ่มหัวข้อ
                        </p>
                        <p
                                id="contentStamp"
                                class="content"
                                [attr.contenteditable]="list.showTools ? 'true' : 'false'"
                                (input)="onContentChange($event, list)"
                                [style.fontWeight]="list.isBold ? 'bold' : 'normal'"
                                [style.fontStyle]="list.isItalic ? 'italic' : 'normal'"
                                [style.width.px]="getMaxLineWidth(list.content, '36px Arial')"
                                [style.color]="list.color"
                                [style.border]="list.showTools ? '1px solid #000055' : 'none'"
                                [style.fontSize.px]="list.fontSize"
                        >
                            เพิ่มเนื้อหา
                        </p>
                        <i
                                *ngIf="list.showEdit"
                                class="pi"
                                [ngClass]="{
              'pi-pencil': !list.showTools,
              'pi-check': list.showTools
            }"
                                style="color: rgb(81, 81, 81); font-size: 1.5rem; margin: 3px"
                                (click)="editMode(list)"
                        ></i>
                    </div>
                    <div
                            class="d-flex justify-content-end textEditor"
                            *ngIf="list.showTools"
                    >
                        <p-colorPicker [(ngModel)]="list.color"></p-colorPicker>
                        <div class="card flex justify-content-center">
                            <p-dropdown
                                    [options]="fontSizes"
                                    [(ngModel)]="list.fontSize"
                                    [showClear]="false"
                                    placeholder="Font Sizes"
                            ></p-dropdown>
                        </div>
                        <button style="font-size: 1rem" (click)="boldText(list)">B</button>
                        <button style="font-size: 1rem" (click)="italicText(list)">I</button>
                        <i
                                class="pi pi-trash"
                                style="
              color: red;
              font-size: 1.7rem;
              margin-left: 85px;
              margin-top: 5px;
            "
                                (click)="deleteLabel(i)"
                        ></i>
                    </div>
                </div>
                <!-- endregion label-stamp -->
            </div>
            <!-- endregion canvas-area -->

            <!-- region submit-button -->
            <button
                    id="submitBtn"
                    class="pn-submit align-self-end"
                    label="บันทีก Stamp"
                    (click)="combinedCanvas()"
            >
                บันทึก Stamp
            </button>
            <!-- endregion submit-button -->
        </div>
    </div>
    <div class="d-flex flex-row" *ngIf="displayChooseTemplate">
        <ng-container *ngFor="let list of templateStampList">
            <div class="m-2" style="width: 200px;height: 100px">
                <img style="width: 200px;height: 100px" [src]="list.templateThumbnail" alt="">
            </div>
        </ng-container>
    </div>
</p-dialog>

